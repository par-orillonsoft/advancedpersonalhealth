(function($){$.fn.lightBox=function(settings){function ___pause(a){var b=new Date;c=null;do{var c=new Date}while(c-b<a)}function ___getPageScroll(){var a=$(document).scrollLeft();var b=$(document).scrollTop();return[a,b]}function ___getPageSize(){pageWidth=$("body").width();pageHeight=$(document).height();windowWidth=$(window).width();windowHeight=$(window).height();return[pageWidth,pageHeight,windowWidth,windowHeight]}function _finish(){$("#jquery-lightbox").remove();$("#jquery-overlay").fadeOut(function(){$("#jquery-overlay").remove()});$("embed, object, select").css({visibility:"visible"});$(window).unbind("resize",_resize_overlay_with_scroll);$(window).unbind("scroll",_resize_overlay_without_scroll);$(document).unbind("keydown",_keyboard_action)}function _preload_neighbor_images(){if(settings.imageArray.length-1>settings.activeImage){objNext=new Image;objNext.src=settings.imageArray[settings.activeImage+1][0]}if(settings.activeImage>0){objPrev=new Image;objPrev.src=settings.imageArray[settings.activeImage-1][0]}}function _keyboard_action(a){keycode=a.keyCode;leftArrow=37;rightArrow=39;escapeKey=27;key=String.fromCharCode(keycode).toLowerCase();if(key==settings.keyToClose||key=="x"||keycode==escapeKey){_finish()}if(key==settings.keyToPrev||keycode==leftArrow){if(settings.activeImage!=0){settings.activeImage=settings.activeImage-1;_set_image_to_view();_disable_keyboard_navigation()}}if(key==settings.keyToNext||keycode==rightArrow){if(settings.activeImage!=settings.imageArray.length-1){settings.activeImage=settings.activeImage+1;_set_image_to_view();_disable_keyboard_navigation()}}}function _disable_keyboard_navigation(){$(document).unbind("keydown",_keyboard_action)}function _enable_keyboard_navigation(){$(document).keydown(_keyboard_action)}function _set_navigation(){$("#lightbox-nav-btnPrev,#lightbox-nav-btnNext").addClass("lightbox-nav-btnBlank");if(settings.activeImage!=0){$("#lightbox-nav-btnPrev").removeClass("lightbox-nav-btnBlank").unbind().bind("click",function(){settings.activeImage=settings.activeImage-1;_set_image_to_view();return false}).show()}if(settings.activeImage!=settings.imageArray.length-1){$("#lightbox-nav-btnNext").removeClass("lightbox-nav-btnBlank").unbind().bind("click",function(){settings.activeImage=settings.activeImage+1;_set_image_to_view();return false}).show()}_enable_keyboard_navigation()}function _show_image_data(){_show_elements();$("#lightbox-image-details-caption").hide();if(settings.imageArray[settings.activeImage][1]){$("#lightbox-image-details-caption").html(settings.imageArray[settings.activeImage][1]).show()}}function _show_image(){_preload_ajax_images();$("#lightbox-loading").hide();$("#lightbox-image").fadeIn("fast",function(){_show_image_data();_set_navigation()});_preload_neighbor_images()}function _preload_ajax_images(){if(typeof settings.ajaxFunction=="function"&&!settings.ajaxEndChecks){if(settings.imageArray.length>1&&settings.activeImage==settings.imageArray.length-2||settings.imageArray.length==1||settings.imageArray.length>1&&settings.activeImage==settings.imageArray.length-1){if(!settings.ajaxFunction(settings)){settings.ajaxEndChecks=1}}}}function _need_to_resize(a,b){var c=$(window).width();if(c<=a+100){var d=a;var e=b;var f=d/e;a=Math.round(c*.8);b=Math.round(a/f);return[a,b]}return false}function _resize_container_image_box(a,b){if((newsizes=_need_to_resize(a,b))!==false){a=newsizes[0];b=newsizes[1];$("#lightbox-image").css("width","100%")}var c=$("#lightbox-container-image-box").width();var d=$("#lightbox-container-image-box").height();var e=a+settings.containerBorderSize*2;var f=b+settings.containerBorderSize*2;var g=c-e;var h=d-f;$("#lightbox-container-navigation-box").css("width",e+100+"px");$("#lightbox-container-image-box").animate({width:e,height:f},settings.containerResizeSpeed,function(){_show_image()});if(g==0&&h==0){if($.browser.msie){___pause(250)}else{___pause(100)}}$("#lightbox-container-image-data-box").css({width:a});var i=$("#jquery-lightbox").offset();var j=___getPageSize();var k=i.left;var l=i.top-j[3]/10;$(window).scrollTo({top:l+"px",left:k+"px"},400)}function _set_image_to_view(){$("#lightbox-loading").show();_hide_elements();var a=new Image;a.onload=function(){$("#lightbox-image").attr("src",settings.imageArray[settings.activeImage][0]);$("#lightbox-image").attr("rel",settings.imageArray[settings.activeImage][2]);_resize_container_image_box(a.width,a.height);settings.onImageLoad(settings);a.onload=function(){}};a.src=settings.imageArray[settings.activeImage][0]}function _show_elements(){$("#lightbox-container-image-data-box").show();$("#lightbox-btnClose").show()}function _hide_elements(){$("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box").hide();$("#lightbox-btnClose").hide()}function _position_lightbox(){var a=___getPageSize();var b=___getPageScroll();$("#jquery-lightbox").css({top:b[1]+a[3]/10,left:b[0]})}function _resize_overlay(){var a=___getPageSize();$("#jquery-overlay").css({width:a[0],height:a[1]})}function _resize_overlay_without_scroll(){_resize_overlay()}function _resize_overlay_with_scroll(){_resize_overlay();_position_lightbox();var a=new Image;a.src=$("#lightbox-image").attr("src");if((newsizes=_need_to_resize(a.width,a.height))!==false){_hide_elements();_resize_container_image_box(a.width,a.height)}}function _set_interface(){$("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-navigation-box"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a><div id="lightbox-container-image-box"><div id="lightbox-container-image"><div id="lightbox-btnClose"><a href="#" id="lightbox-secNav-btnClose">'+settings.imageCloseText+'</a></div><img id="lightbox-image"><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"></a></div></div></div></div><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span></div></div></div></div>');$("#lightbox-container-image").hover(function(a){$("#lightbox-btnClose").fadeIn("fast")},function(a){$("#lightbox-btnClose").fadeOut("fast")});var a=___getPageSize();$("#jquery-overlay").css({opacity:settings.overlayOpacity,width:a[0],height:a[1]}).fadeIn();var b=___getPageScroll();$("#jquery-lightbox").css({top:b[1]+a[3]/10,left:b[0]}).show();$("#jquery-overlay,#jquery-lightbox").click(function(a){if($(a.target).parents("#lightbox-container-image-data-box").length==0)_finish()});$("#lightbox-loading-link,#lightbox-btnClose").click(function(){_finish();return false});$(window).resize(_resize_overlay_with_scroll);$(window).scroll(_resize_overlay_without_scroll)}function _get_id(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.id)return decoded_rel.id}return""}function _get_title(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.title)return decoded_rel.title}return""}function _get_full_image(obj){rel=$(obj).attr("rel");if(typeof rel!="undefined"&&rel.indexOf("{")>-1&&rel.indexOf("}")>-1){eval("var decoded_rel = "+rel+";");if(typeof decoded_rel=="object"&&decoded_rel.link)return decoded_rel.link}return""}function _start(a,b){$("embed, object, select").css({visibility:"hidden"});_set_interface();settings.imageArray.length=0;settings.activeImage=0;settings.ajaxEndChecks=0;if(b.length==1){href=_get_full_image(a);title=_get_title(a);id=_get_id(a);settings.addImage(settings,href,title,id)}else{for(var c=0;c<b.length;c++){href=_get_full_image(b[c]);title=_get_title(b[c]);id=_get_id(b[c]);if(href==_get_full_image(a))settings.activeImage=c;settings.addImage(settings,href,title,id)}}_set_image_to_view()}function _initialize(){_start(this,jQueryMatchedObj);return false}settings=jQuery.extend({overlayOpacity:.8,fixedNavigation:false,imageCloseText:"« back to gallery",containerBorderSize:10,containerResizeSpeed:200,keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0,ajaxEndChecks:0,ajaxFunction:function(a){return false},onImageLoad:function(a){return false},addImage:function(a,b,c,d){if(c.length>0&&c.charAt(0)=="#"&&$(c).length>0)c=$(c).html();a.imageArray.push([b,c,d])}},settings);var jQueryMatchedObj=this;return this.unbind("click").click(_initialize)}})(jQuery);(function(a){function c(a){return typeof a=="object"?a:{top:a,left:a}}var b=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1};b.window=function(b){return a(window)._scrollable()};a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return a.browser.safari||d.compatMode=="BackCompat"?d.body:d.documentElement})};a.fn.scrollTo=function(d,e,f){if(typeof e=="object"){f=e;e=0}if(typeof f=="function")f={onAfter:f};if(d=="max")d=9e9;f=a.extend({},b.defaults,f);e=e||f.speed||f.duration;f.queue=f.queue&&f.axis.length>1;if(f.queue)e/=2;f.offset=c(f.offset);f.over=c(f.over);return this._scrollable().each(function(){function m(a){h.animate(k,e,f.easing,a&&function(){a.call(this,d,f)})}var g=this,h=a(g),i=d,j,k={},l=h.is("html,body");switch(typeof i){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(i)){i=c(i);break}i=a(i,this);case"object":if(i.is||i.style)j=(i=a(i)).offset()}a.each(f.axis.split(""),function(a,c){var d=c=="x"?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=g[n],p=b.max(g,c);if(j){k[n]=j[e]+(l?0:o-h.offset()[e]);if(f.margin){k[n]-=parseInt(i.css("margin"+d))||0;k[n]-=parseInt(i.css("border"+d+"Width"))||0}k[n]+=f.offset[e]||0;if(f.over[e])k[n]+=i[c=="x"?"width":"height"]()*f.over[e]}else{var q=i[e];k[n]=q.slice&&q.slice(-1)=="%"?parseFloat(q)/100*p:q}if(/^\d+$/.test(k[n]))k[n]=k[n]<=0?0:Math.min(k[n],p);if(!a&&f.queue){if(o!=k[n])m(f.onAfterFirst);delete k[n]}});m(f.onAfter);}).end()};b.max=function(b,c){var d=c=="x"?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])};})(jQuery)