(function(a){a.fn.piroBox_ext=function(b){function y(){a(window).scroll(function(){var b=a(window).height();var c=a(window).width();var d=k.height();var e=k.width();k.css({left:c/2-e/2+"px",top:parseInt(a(document).scrollTop())+(b-d)/2})})}function z(){if(k.is(":visible")){a(".my_frame").remove();k.add(q).add(s).stop();var c=k;if(a.browser.msie){c=q.add(m);a(".div_reg_"+b.htmlClass+" img").remove()}else{c=k.add(m)}c.piroFadeOut(200,function(){q.html("");r.add(l).add(t).hide();u.hide();m.add(k).hide().css("visibility","visible")})}}b=jQuery.extend({piro_speed:700,bg_alpha:.9,piro_scroll:true,draggable:false,selector:'a[class*="pirobox"]',htmlClass:""},b);a.fn.piroFadeIn=function(b,c){a(this).fadeIn(b,function(){if(jQuery.browser.msie)a(this).get(0).style.removeAttribute("filter");if(c!=undefined)c()})};a.fn.piroFadeOut=function(b,c){a(this).fadeOut(b,function(){if(jQuery.browser.msie)a(this).get(0).style.removeAttribute("filter");if(c!=undefined)c()})};var c=a(b.selector);var d=new Object;for(var e=0;e<c.length;e++){var f=a(c[e]);d["a."+f.attr("class").match(/^pirobox_gall\w*/)]=0}var g=new Array;for(var h in d){g.push(h)}for(var e=0;e<g.length;e++){a(g[e]+":first").addClass("rsmg_content_first");a(g[e]+":last").addClass("rsmg_content_last")}var i=a(c);a('a[class*="pirobox_gall"]').each(function(a){this.rev=a+0});var j='<div class="piro_overlay piro_overlay_'+b.htmlClass+'"></div>'+'<table class="piro_html piro_html_'+b.htmlClass+'" cellpadding="0" cellspacing="0">'+"<tr>"+'<td class="h_t_l"></td>'+'<td class="h_t_c"></td>'+'<td class="h_t_r"></td>'+"</tr>"+"<tr>"+'<td class="h_c_l"></td>'+'<td class="h_c_c">'+'<div class="piro_loader piro_loader_'+b.htmlClass+'" title="close"><span></span></div>'+'<div class="resize resize_'+b.htmlClass+'">'+'<div class="piro_nav_container piro_nav_container_'+b.htmlClass+'">'+'<a href="#prev" class="piro_prev piro_prev_'+b.htmlClass+'" title="previous"></a>'+'<a href="#next" class="piro_next piro_next_'+b.htmlClass+'" title="next"></a>'+'<div class="piro_close piro_close_'+b.htmlClass+'" title="close"></div>'+"</div>"+'<div class="piro_caption piro_caption_'+b.htmlClass+'"></div>'+'<div class="div_reg div_reg_'+b.htmlClass+'"></div>'+"</div>"+"</td>"+'<td class="h_c_r"></td>'+"</tr>"+"<tr>"+'<td class="h_b_l"></td>'+'<td class="h_b_c"></td>'+'<td class="h_b_r"></td>'+"</tr>"+"</table>";a("body").append(j);var k=a(".piro_html_"+b.htmlClass),l=a(".piro_caption_"+b.htmlClass),m=a(".piro_overlay_"+b.htmlClass),n=a(".piro_next_"+b.htmlClass),o=a(".piro_prev_"+b.htmlClass),p=a(".piro_close_"+b.htmlClass),q=a(".div_reg_"+b.htmlClass),r=a(".piro_loader_"+b.htmlClass),s=a(".resize_"+b.htmlClass),t=a(".btn_info"),u=a(".piro_nav_container_"+b.htmlClass);var v=.95;if(b.draggable){if(a.browser.msie){k.draggable({handle:".h_t_c,.h_b_c,.div_reg_"+b.htmlClass+" img"})}else{k.draggable({handle:".h_t_c,.h_b_c,.div_reg_"+b.htmlClass+" img",opacity:.8})}}var w=a(window).height();var x=a(window).width();u.hide();k.css({left:x/2-250+"px",top:parseInt(a(document).scrollTop())+100});a(k).add(l).add(m).hide();m.css({opacity:b.bg_alpha});a(o).add(n).bind("click",function(b){u.hide();b.preventDefault();n.add(o).hide();var c=parseInt(a('a[class*="pirobox_gall"]').filter(".rsmg_content_item").attr("rev"));var d=a(this).is(o)?a('a[class*="pirobox_gall"]').eq(c-1):a('a[class*="pirobox_gall"]').eq(c+1);d.click()});a("html").bind("keyup",function(b){if(b.keyCode==27){b.preventDefault();if(a(p).is(":visible")){z()}}});a("html").bind("keyup",function(b){if(a(".rsmg_content_item").is(".rsmg_content_first")){}else if(b.keyCode==37){b.preventDefault();if(a(p).is(":visible")){o.click()}}});a("html").bind("keyup",function(b){if(a(".rsmg_content_item").is(".rsmg_content_last")){}else if(b.keyCode==39){b.preventDefault();if(a(p).is(":visible")){n.click()}}});a(window).resize(function(){var b=a(window).height();var c=a(window).width();var d=k.height();var e=k.width();k.css({left:c/2-e/2+"px",top:parseInt(a(document).scrollTop())+(b-d)/2})});if(b.piro_scroll==true){y()}a(i).each(function(){function f(){function f(){if(d[1]=="full"&&d[2]=="full"){d[2]=a(window).height()-70;d[1]=a(window).width()-55}var c=a(window).height();var e=a(window).width();p.hide();q.add(s).animate({height:+d[2]+"px",width:+d[1]+"px"},b.piro_speed).css("visibility","visible");k.animate({height:+d[2]+20+"px",width:+d[1]+20+"px",left:e/2-(d[1]/2+10)+"px",top:parseInt(a(document).scrollTop())+(c-d[2])/2-10},b.piro_speed,function(){n.add(o).css({height:"20px",width:"20px"});n.add(o).css("visibility","visible");u.show();p.show()})}function g(){var c=new Image;c.onload=function(){l.add(t).hide();var d=a(window).height();var e=a(window).width();var f=c.height;var g=c.width;if(f+20>d||g+20>e){var h=(g+20)/e;var i=(f+20)/d;if(i>h){g=Math.round(c.width*(v/i));f=Math.round(c.height*(v/i))}else{g=Math.round(c.width*(v/h));f=Math.round(c.height*(v/h))}}else{f=c.height;g=c.width}var d=a(window).height();var e=a(window).width();a(c).height(f).width(g).hide();a(c).fadeOut(300,function(){});a(".div_reg_"+b.htmlClass+" img").remove();a(".div_reg_"+b.htmlClass+"").html("");q.append(c).show();a(c).addClass("immagine");q.add(s).animate({height:f+"px",width:g+"px"},b.piro_speed);k.animate({height:f+20+"px",width:g+20+"px",left:e/2-(g+20)/2+"px",top:parseInt(a(document).scrollTop())+(d-f)/2-20},b.piro_speed,function(){var b=s.width();l.css({width:b+"px"});r.hide();a(c).fadeIn(300,function(){p.add(t).show();l.slideDown(200);n.add(o).css({height:"20px",width:"20px"});n.add(o).css("visibility","visible");u.show();s.resize(function(){NimgW=c.width;NimgH=c.heigh;l.css({width:NimgW+"px"})})})})};c.src=e;r.click(function(){c.src="about:blank"})}k.add(m).add(q).add(r).show();switch(d[0]){case"iframe":q.html("").css("overflow","hidden");s.css("overflow","hidden");p.add(t).add(l).hide();f();q.piroFadeIn(300,function(){q.append('<iframe id="my_frame" class="my_frame" src="'+e+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>');a(".my_frame").css({height:+d[2]+"px",width:+d[1]+"px"});r.hide()});break;case"content":q.html("").css("overflow","auto");s.css("overflow","auto");a(".my_frame").remove();p.add(t).add(l).hide();f();q.piroFadeIn(300,function(){q.load(e);r.hide()});break;case"inline":q.html("").css("overflow","auto");s.css("overflow","auto");a(".my_frame").remove();p.add(t).add(l).hide();f();q.piroFadeIn(300,function(){a(e).clone(true).appendTo(q).piroFadeIn(300);r.hide()});break;case"gallery":q.css("overflow","hidden");s.css("overflow","hidden");a(".my_frame").remove();p.add(t).add(l).hide();if(typeof c!="undefined"){if(c=="")l.html("");else l.html("<p>"+c+"</p>")}g();break;case"single":p.add(t).add(l).hide();q.html("").css("overflow","hidden");s.css("overflow","hidden");a(".my_frame").remove();if(typeof c!="undefined"){if(c=="")l.html("");else l.html("<p>"+c+"</p>")}g();break}}var c=a(this).attr("title");a(this).removeAttr("title");var d=a(this).attr("rel").split("-");var e=a(this).attr("href");a(this).unbind();a(this).bind("click",function(c){m.css({opacity:b.bg_alpha});c.preventDefault();n.add(o).hide().css("visibility","hidden");a(i).filter(".rsmg_content_item").removeClass("rsmg_content_item");a(this).addClass("rsmg_content_item");f();if(a(this).is(".rsmg_content_first")){o.hide();n.show()}else{n.add(o).show()}if(a(this).is(".rsmg_content_last")){if(!a(this).is(".rsmg_content_first"))o.show();n.hide()}if(a(this).is(".pirobox")){n.add(o).hide()}})});a(".immagine").live("click",function(){l.slideToggle(200)});p.add(r).add(m).bind("click",function(a){a.preventDefault();z()})}})(jQuery)